<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Archkr | SillyTavern Extensions & Lore</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        display: ['Space Grotesk', 'sans-serif'],
                        mono: ['ui-monospace', 'SFMono-Regular', 'Menlo', 'Monaco', 'Consolas', "Liberation Mono", "Courier New", 'monospace'],
                    },
                    colors: {
                        primary: '#8b5cf6', // Violet
                        secondary: '#ec4899', // Pink (DAL vibes)
                        dark: '#0f172a',
                        darker: '#020617',
                        card: '#1e293b',
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'spin-slow': 'spin 12s linear infinite',
                        'fade-in': 'fadeIn 0.5s ease-out forwards',
                        'slide-up': 'slideUp 0.5s ease-out forwards',
                        'toast-in': 'toastIn 0.3s ease-out forwards',
                        'toast-out': 'toastOut 0.3s ease-in forwards',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-20px)' },
                        },
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        toastIn: {
                            '0%': { transform: 'translateY(100%)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        },
                        toastOut: {
                            '0%': { transform: 'translateY(0)', opacity: '1' },
                            '100%': { transform: 'translateY(100%)', opacity: '0' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }
        
        /* Horizontal Scrollbar for Carousel */
        .carousel-container::-webkit-scrollbar { height: 6px; }
        .carousel-container::-webkit-scrollbar-track { background: rgba(30, 41, 59, 0.5); border-radius: 10px; }
        .carousel-container::-webkit-scrollbar-thumb { background: rgba(236, 72, 153, 0.5); border-radius: 10px; }
        .carousel-container::-webkit-scrollbar-thumb:hover { background: rgba(236, 72, 153, 0.8); }

        /* Glassmorphism */
        .glass {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .glass-card {
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(148, 163, 184, 0.1);
            transition: all 0.3s ease;
        }

        .glass-card:hover {
            transform: translateY(-5px);
            background: rgba(30, 41, 59, 0.8);
            border-color: rgba(139, 92, 246, 0.5);
            box-shadow: 0 10px 30px -10px rgba(139, 92, 246, 0.3);
        }

        /* Animated Background Mesh */
        .mesh-bg {
            position: fixed;
            top: 0; left: 0; width: 100vw; height: 100vh;
            z-index: -1; background-color: #020617; overflow: hidden;
        }

        .orb {
            position: absolute; border-radius: 50%;
            filter: blur(80px); opacity: 0.4;
            animation: float 10s infinite ease-in-out;
        }

        .orb-1 { width: 400px; height: 400px; background: #4c1d95; top: -100px; left: -100px; animation-delay: 0s; }
        .orb-2 { width: 300px; height: 300px; background: #be185d; bottom: 10%; right: -50px; animation-delay: -2s; }
        .orb-3 { width: 200px; height: 200px; background: #0ea5e9; top: 40%; left: 40%; animation-delay: -4s; opacity: 0.2; }

        /* Utilities */
        .hero-text-gradient {
            background: linear-gradient(135deg, #e2e8f0 0%, #a78bfa 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .hidden-page { display: none; }
        .visible-page { display: block; animation: fadeIn 0.5s ease-out; }
        
        /* Toast */
        #toast-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 100;
            pointer-events: none;
        }
        .toast {
            pointer-events: auto;
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 24px;
            background: #1e293b;
            border: 1px solid rgba(139, 92, 246, 0.3);
            border-radius: 12px;
            color: white;
            box-shadow: 0 10px 30px -10px rgba(0,0,0,0.5);
        }
    </style>
</head>
<body class="text-slate-300 font-sans min-h-screen relative selection:bg-primary selection:text-white">

    <!-- Background Elements -->
    <div class="mesh-bg">
        <div class="orb orb-1"></div>
        <div class="orb orb-2"></div>
        <div class="orb orb-3"></div>
        <div style="background-image: radial-gradient(rgba(255,255,255,0.05) 1px, transparent 1px); background-size: 30px 30px; width: 100%; height: 100%; position: absolute;"></div>
    </div>
    
    <!-- Toast Notification Container -->
    <div id="toast-container"></div>

    <!-- Navigation -->
    <nav class="fixed w-full z-50 transition-all duration-300" id="navbar">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-20">
                <div class="flex items-center gap-3 cursor-pointer" onclick="navigateTo('home')">
                    <!-- Updated PFP for Top Left -->
                    <img src="https://github.com/user-attachments/assets/0c368a6d-2aea-41ec-a6fd-823168b3fd29" alt="Archkr Logo" class="w-10 h-10 rounded-lg object-cover shadow-lg shadow-primary/20 bg-dark">
                    <span class="font-display font-bold text-xl tracking-wide text-white">Archkr<span class="text-primary">.dev</span></span>
                </div>
                <div class="flex items-center space-x-4 md:space-x-8">
                    <button onclick="navigateTo('home')" class="text-slate-400 hover:text-white transition-colors text-sm font-medium">Home</button>
                    <button onclick="scrollToSection('extensions')" class="text-slate-400 hover:text-white transition-colors text-sm font-medium hidden sm:block">Extensions</button>
                    <button onclick="scrollToSection('lorebooks')" class="text-slate-400 hover:text-white transition-colors text-sm font-medium hidden sm:block">Lorebooks</button>
                    <button onclick="scrollToSection('workshop')" class="text-primary hover:text-white transition-colors text-sm font-medium hidden sm:block">Workshop</button>
                    <a href="https://github.com/Archkr" target="_blank" class="px-4 py-2 rounded-full glass hover:bg-white/10 transition-all text-white text-sm font-medium flex items-center gap-2 border border-white/10">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd"></path></svg>
                        <span class="hidden sm:inline">GitHub</span>
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- VIEW: HOME -->
    <div id="view-home" class="visible-page pt-20">
        <!-- Hero Section -->
        <header class="relative pt-20 pb-20 md:pt-32 md:pb-32 overflow-hidden">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
                <div class="text-center max-w-3xl mx-auto animate-slide-up">
                    <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-primary/10 border border-primary/20 text-primary text-xs font-medium mb-6 animate-pulse-slow">
                        <span class="w-2 h-2 rounded-full bg-primary"></span>
                        Proper website coming in January
                    </div>
                    <h1 class="text-5xl md:text-7xl font-display font-bold mb-6 hero-text-gradient tracking-tight">
                        Enhancing your <br />
                        <span class="text-white relative inline-block">
                            SillyTavern
                            <svg class="absolute w-full h-3 -bottom-1 left-0 text-primary opacity-60" viewBox="0 0 200 9" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2.00025 6.99997C2.00025 6.99997 23.3659 3.05926 77.0004 2.99999C127.351 2.94435 156.401 5.48514 167.361 5.95514C179.313 6.46781 198.001 7.00002 198.001 7.00002" stroke="currentColor" stroke-width="3" stroke-linecap="round"/></svg>
                        </span>
                        Experience
                    </h1>
                    <p class="text-lg md:text-xl text-slate-400 mb-10 leading-relaxed">
                        A collection of high-performance extensions and expansive lorebooks designed to deepen your immersion.
                    </p>
                    <div class="flex flex-col sm:flex-row items-center justify-center gap-4">
                        <button onclick="scrollToSection('extensions')" class="w-full sm:w-auto px-8 py-3.5 rounded-lg bg-white text-darker font-bold hover:bg-slate-200 transition-colors flex items-center justify-center gap-2">
                            Browse Extensions
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path></svg>
                        </button>
                        <button onclick="scrollToSection('lorebooks')" class="w-full sm:w-auto px-8 py-3.5 rounded-lg glass text-white font-medium hover:bg-white/10 transition-colors flex items-center justify-center gap-2">
                            View Lorebooks
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-32">
            
            <!-- Stats Section -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-24 animate-slide-up" style="animation-delay: 0.2s;" id="global-stats">
                <!-- Stats injected by JS -->
            </div>

            <!-- Extensions Section -->
            <section id="extensions" class="mb-24 animate-slide-up" style="animation-delay: 0.3s;">
                <div class="flex items-end justify-between mb-10">
                    <div>
                        <h2 class="text-3xl font-display font-bold text-white mb-2">Extensions</h2>
                        <p class="text-slate-400">Add functionality and flair to your SillyTavern setup.</p>
                    </div>
                    <div class="hidden md:block h-px flex-1 bg-slate-800 ml-8 relative top-[-10px]"></div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="extensions-grid">
                    <!-- Content injected via JS -->
                </div>
            </section>

            <!-- Lorebooks Section -->
            <section id="lorebooks" class="animate-slide-up mb-24" style="animation-delay: 0.4s;">
                <div class="flex items-end justify-between mb-10">
                    <div>
                        <h2 class="text-3xl font-display font-bold text-white mb-2">World & Lore</h2>
                        <p class="text-slate-400">Collection of lorebooks I made, and recommend.</p>
                    </div>
                    <div class="hidden md:block h-px flex-1 bg-slate-800 ml-8 relative top-[-10px]"></div>
                </div>

                <div class="relative rounded-2xl overflow-hidden glass-card border border-pink-500/20">
                    <div class="absolute top-0 right-0 w-64 h-64 bg-secondary/10 rounded-full filter blur-3xl pointer-events-none -translate-y-1/2 translate-x-1/2"></div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 p-8" id="lorebooks-grid">
                        <!-- Content injected via JS -->
                    </div>
                </div>
            </section>

            <!-- Steven's Workshop Section (NEW) -->
            <section id="workshop" class="animate-slide-up" style="animation-delay: 0.5s;">
                <div class="flex items-end justify-between mb-10">
                    <div>
                        <h2 class="text-3xl font-display font-bold text-white mb-2">Steven's Workshop</h2>
                        <p class="text-slate-400">My personal tuning for the ultimate roleplay experience.</p>
                    </div>
                    <div class="hidden md:block h-px flex-1 bg-slate-800 ml-8 relative top-[-10px]"></div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- Parameters Card -->
                    <div class="glass p-8 rounded-2xl border border-primary/20 relative overflow-hidden group hover:border-primary/50 transition-all duration-300">
                        <div class="absolute top-0 right-0 p-3 bg-primary/10 rounded-bl-2xl">
                             <svg class="w-6 h-6 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"></path></svg>
                        </div>
                        
                        <div class="flex justify-between items-center mb-6">
                            <div>
                                <h3 class="text-2xl font-bold text-white">Parameter Settings</h3>
                                <p class="text-slate-400 text-sm">Primary Target: <span class="text-primary font-mono">Sonnet 4.5</span></p>
                            </div>
                        </div>
                        
                        <div class="space-y-5">
                             <!-- Temperature -->
                             <div>
                                <div class="flex justify-between text-xs font-mono text-slate-300 mb-1">
                                    <span>Temperature</span>
                                    <span class="text-white">1.00</span>
                                </div>
                                <div class="h-2 bg-slate-800 rounded-full overflow-hidden">
                                    <div class="h-full bg-primary" style="width: 50%"></div>
                                </div>
                             </div>

                             <!-- Frequency Penalty -->
                             <div>
                                <div class="flex justify-between text-xs font-mono text-slate-300 mb-1">
                                    <span>Frequency Penalty</span>
                                    <span class="text-white">0.00</span>
                                </div>
                                <div class="h-2 bg-slate-800 rounded-full overflow-hidden">
                                    <div class="h-full bg-primary" style="width: 0%"></div>
                                </div>
                             </div>

                             <!-- Presence Penalty -->
                             <div>
                                <div class="flex justify-between text-xs font-mono text-slate-300 mb-1">
                                    <span>Presence Penalty</span>
                                    <span class="text-white">0.00</span>
                                </div>
                                <div class="h-2 bg-slate-800 rounded-full overflow-hidden">
                                    <div class="h-full bg-primary" style="width: 0%"></div>
                                </div>
                             </div>

                             <!-- Top P -->
                             <div>
                                <div class="flex justify-between text-xs font-mono text-slate-300 mb-1">
                                    <span>Top P</span>
                                    <span class="text-white">0.95</span>
                                </div>
                                <div class="h-2 bg-slate-800 rounded-full overflow-hidden">
                                    <div class="h-full bg-primary" style="width: 95%"></div>
                                </div>
                             </div>
                        </div>
                    </div>

                    <!-- CoT Card -->
                    <div class="glass p-8 rounded-2xl border border-secondary/20 relative overflow-hidden group hover:border-secondary/50 transition-all duration-300 flex flex-col h-[500px]">
                        <div class="absolute top-0 right-0 p-3 bg-secondary/10 rounded-bl-2xl">
                             <svg class="w-6 h-6 text-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path></svg>
                        </div>

                        <div class="flex justify-between items-center mb-4">
                            <div>
                                <h3 class="text-2xl font-bold text-white">CoT & Prompts</h3>
                                <p class="text-slate-400 text-sm">Chain of Thought logic.</p>
                            </div>
                            <button onclick="copyCoT()" class="text-xs bg-secondary/10 hover:bg-secondary/20 text-secondary border border-secondary/20 px-3 py-1.5 rounded-lg transition-colors font-medium">
                                Copy All
                            </button>
                        </div>
                        
                        <div class="bg-darker/50 rounded-xl p-4 font-mono text-xs text-slate-300 border border-white/5 overflow-y-auto custom-scrollbar flex-grow whitespace-pre-wrap select-text" id="cot-content">## Steven's Tiny CoT

Check for OOC commands first. If present and requires pause, address only that—skip narrative weaving.

If no OOC: Begin with &lt;think&gt;\n output.

**CoT Shape / Formatting (Ultra-Light)**

* One-sentence Goal at the top of &lt;think&gt;
* Use compact bullet points, not paragraphs
* Shorthand allowed; keep each point minimal but clear
* Avoid over-detail; focus only on next relevant beats
* Vary sentence rhythm (micro-rhythm)
* Ensure user has a natural opening for initiative
* Avoid repeating structural response patterns
* Maintain pacing: advance exactly one meaningful beat
* Keep POV strictly aligned with {{char}}
* No narrative language inside &lt;think&gt;; planning only
* Maintain the section order exactly as listed
* End cleanly with &lt;/think&gt; before delivering narrative

**1. Scene State**

* Who's present | Where are off-screen characters
* {{user}}'s last action/speech | {{char}}'s last action/speech | NPC actions/speech
* If multiple characters present: ensure each present character gets at least one clear line/action; balance speaking turns and avoid crowding a single voice.

**1.5. Multi-Character Balance**

* If multiple characters are present: ensure each gets one clear action or line
* Maintain balanced turn-taking without overcrowding
* Prioritize clarity of who is acting/speaking

**2. Character Check**

**2.5 Internal Dialogue Reinforcement**

* Ensure {{char}} uses internal dialogue when fitting

* Internal thoughts always wrapped in *asterisks*

* Prioritize natural, reactive internal lines tied to emotion or perception

* Personality traits | Physical description | Current clothing | Health/condition

**3. Plot Tracking**

 **3.1 Ultra-Light Continuity**

* Time of day | Carried items | Outstanding promises

**3.2 Repetition Scan**

* Ensure no reused beats/phrasing from last few outputs

**3.3 Tone & Mood**

* Confirm scene mood and maintain consistent emotional direction

**3.4 Sensory Anchor**

* Add 1 small sensory cue (rotating sense preferred)

**4. Knowledge Limits**

* What {{char}} witnessed/heard vs. didn't
* NO mind-reading {{user}}'s thoughts
* React only to known info

**5: Narrative Guidance**

* For starting new scenes:

  * Try different openings (in media res, epigraph, etc.)
  * Draft first few beats
  * Drop breadcrumbs
* For expanding existing scenes:

  * Focus on urgent plot points
  * Create narrative hook opportunity that doesn't tangle
  * Plan inclusion into narrative
  * Perform seamless weave into new threads
  * Ensure fresh narrative with no repeated themes, dialogue, or thoughts

**5. Response Plan**

* Review dialogue/story rules | Ground in {{char}}'s voice
* Encourage internal dialogue wrapped in *asterisks* when appropriate
* Reaction logic based on character | Next action from that reaction
* Beat check: Does {{user}} need to resolve something? Does branch need elaboration? Avoid repetitive questions—use calls to action.

**6. Anatomy Check**

* Account for height/weight/measurements
* Verify movement is physically possible (limb length, pivot points, contact points)
* If spatial error: propose alternate action

**7. Environment**

* Current positions | Realistic time passage | How actions affect surroundings | Spatial continuity

**8. Style Adherence**

* Confirm: Perspective, Mode, Philosophy, Difficulty, Immersion, Genre, Pacing, Length, Development, Prose, Dialogue, Detail rules
* Incorporate length constraint from {{setvar::length}} dynamically:

  * Read limits directly from the variable (paragraphs | words | tokens)
  * Plan beat-size around the active limits
  * Prioritize density over expansion; condense where necessary
* No early cuts—smooth narration unless intentional fragments
* No Loom terminology leak | No echoing previous dialogue/thoughts

**9. Final Pass**

* Formatting satisfied | Alignment confirmed | No instruction leaks | In-character accuracy | Self-correct errors

**For new scenes if vague: **

Close with \n&lt;/think&gt; output, then deliver response.</div>
                    </div>
                </div>
            </section>

        </main>
    </div>

    <!-- VIEW: PROJECT DETAIL -->
    <div id="view-detail" class="hidden-page pt-32 pb-20 min-h-screen">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
            <!-- Back Button -->
            <button onclick="navigateTo('home')" class="mb-8 flex items-center gap-2 text-slate-400 hover:text-white transition-colors group">
                <svg class="w-5 h-5 transform group-hover:-translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
                Back to Hub
            </button>

            <!-- Detail Content -->
            <div id="detail-content" class="animate-fade-in">
                <!-- Content injected via JS -->
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="border-t border-slate-800 bg-darker/50 backdrop-blur-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-4 md:mb-0">
                    <span class="font-display font-bold text-lg text-white">Archkr<span class="text-primary">.dev</span></span>
                    <p class="text-slate-500 text-sm mt-1">Built for the SillyTavern Community.</p>
                </div>
                <div class="flex space-x-6">
                    <a href="https://github.com/Archkr" class="text-slate-400 hover:text-white transition-colors">GitHub</a>
                </div>
            </div>
        </div>
    </footer>

    <!-- JavaScript Logic -->
    <script>
        // --- Data Configuration ---
        const REPOS = [
            { id: 'SillyTavern-CostumeSwitch', owner: 'Archkr', type: 'extension', icon: 'shirt' },
            { id: 'SillyTavern-OutfitSwitch', owner: 'Archkr', type: 'extension', icon: 'layers' },
            { id: 'ST-WorldEngine', owner: 'Archkr', type: 'extension', icon: 'globe' },
            { id: 'ST-DAL-Lorebooks', owner: 'Archkr', type: 'lorebook', icon: 'book' }
        ];

        const ICONS = {
            shirt: `<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path></svg>`,
            layers: `<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path></svg>`,
            globe: `<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"></path></svg>`,
            book: `<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path></svg>`,
            star: `<svg class="w-4 h-4 text-yellow-500" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>`,
            git: `<svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg>`,
            update: `<svg class="w-3 h-3 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>`,
            check: `<svg class="w-5 h-5 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>`,
            cpu: `<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z"></path></svg>`,
            flash: `<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>`,
            sparkles: `<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"></path></svg>`,
            code: `<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg>`,
            thumbsUp: `<svg class="w-4 h-4 text-blue-400" fill="currentColor" viewBox="0 0 20 20"><path d="M2 10.5a1.5 1.5 0 113 0v6a1.5 1.5 0 01-3 0v-6zM6 10.333v5.43a2 2 0 001.106 1.79l.05.025A4 4 0 008.943 18h5.416a2 2 0 001.962-1.608l1.2-6A2 2 0 0015.56 8H12V4a2 2 0 00-2-2 1 1 0 00-1 1v.667a4 4 0 01-.8 2.4L6.8 7.933a4 4 0 00-.8 2.4z"/></svg>`,
            download: `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>`
        };

        const ENRICHED_DATA = {
            'SillyTavern-CostumeSwitch': {
                name: "Costume Switcher",
                description: "Companion to Character Expressions. Swaps costumes/avatars based on the active speaker in real-time.",
                longDescription: "Costume Switcher listens to the streaming output from your model, scores every character mention it finds, and immediately updates the displayed costume to match the active speaker. It ships with a powerful custom detection engine (v4) that handles attribution, action beats, and fuzzy matching, plus a Live Pattern Tester and slash commands to give you full control over your stage crew.",
                features: ["Narrative-Aware Detection", "Scene Roster Logic", "Live Pattern Tester", "Custom Detection Engine v4"],
                installCommand: "https://github.com/Archkr/SillyTavern-CostumeSwitch",
                stargazers_count: 124, forks_count: 12, pushed_at: "2023-10-15T10:00:00Z", language: "JavaScript",
                upvotes: 36
            },
            'SillyTavern-OutfitSwitch': {
                name: "Outfit Switcher",
                description: "A slim, single-character wardrobe manager. Fires costumes based on keywords or regex triggers.",
                longDescription: "Spun out of the Costume Switcher's Outfit Lab, this extension focuses on single-character automation. It watches streaming responses for specific triggers to change outfits instantly while preserving manual overrides. It's the ideal lightweight alternative for focused setups or specific character workflows.",
                features: ["Single-Character Focus", "Stream-Aware Triggers", "Variant Shortcuts", "Manual Safety Net"],
                installCommand: "https://github.com/Archkr/SillyTavern-OutfitSwitch",
                stargazers_count: 89, forks_count: 8, pushed_at: "2023-11-02T14:30:00Z", language: "JavaScript",
                upvotes: 10
            },
            'ST-WorldEngine': {
                name: "World Engine",
                description: "A comprehensive world-building engine for SillyTavern. Manage complex states, locations, and time-based events.",
                longDescription: "Turn SillyTavern into a living, breathing world. ST-WorldEngine introduces a robust state management system that tracks global variables, NPC locations, and world events. It's the backbone for complex RPG-style roleplays where actions have lasting consequences.",
                features: ["Global State Variables", "Location Tracking System", "Event Scheduler", "Inventory Management API"],
                installCommand: "https://github.com/Archkr/ST-WorldEngine",
                stargazers_count: 245, forks_count: 34, pushed_at: "2023-12-01T09:15:00Z", language: "TypeScript",
                upvotes: 22
            },
            'ST-DAL-Lorebooks': {
                name: "Date a Live",
                imageUrl: "https://github.com/user-attachments/assets/05a9c23b-ce19-497a-b576-056f869e423d",
                description: "High-fidelity World Info repository. Over 40k tokens of lore-accurate data, factions, and mechanics.",
                longDescription: "A massive, obsessive project containing over 40,000 tokens of perfectly consistent world info. Includes a Core Lorebook covering Spirits, DEM, Ratatoskr, and World Mechanics, plus a Storyline Addon to manage arcs. Designed for Lucid Loom and Gemini 2.5 Pro for the best experience.",
                features: ["40k+ Token Database", "Canon-Compliant Hard Rules", "Storyline Arcs System", "OC Integration Guide"],
                installCommand: "Download JSON from GitHub Releases",
                stargazers_count: 312, forks_count: 45, pushed_at: "2024-01-20T18:45:00Z", language: "JSON",
                downloads: [
                    { name: "Arc Lorebook", url: "https://github.com/Archkr/ST-DAL-Lorebooks/tree/main/Arc%20Lorebook" },
                    { name: "Main Lorebook", url: "https://github.com/Archkr/ST-DAL-Lorebooks/tree/main/Main%20Lorebook" },
                    { name: "Vectorized Main Lorebook", url: "https://github.com/Archkr/ST-DAL-Lorebooks/tree/main/Vectorized%20Main%20Lorebook" }
                ],
                models: [
                    { name: "Sonnet 4.5", provider: "Anthropic", icon: "cpu", color: "text-orange-400", bg: "bg-orange-500/10", border: "border-orange-500/20" },
                    { name: "Gemini 2.5 Pro", provider: "Google", icon: "flash", color: "text-blue-400", bg: "bg-blue-500/10", border: "border-blue-500/20" },
                    { name: "Gemini 3 Pro", provider: "Google", icon: "sparkles", color: "text-indigo-400", bg: "bg-indigo-500/10", border: "border-indigo-500/20" },
                    { name: "DeepSeek", provider: "DeepSeek", icon: "code", color: "text-cyan-400", bg: "bg-cyan-500/10", border: "border-cyan-500/20" }
                ],
                cast: [
                    { name: "Shido Itsuka", role: "Protagonist", color: "blue" },
                    { name: "Tohka Yatogami", role: "Princess", color: "purple" },
                    { name: "Origami Tobiichi", role: "Angel", color: "slate" },
                    { name: "Kotori Itsuka", role: "Efreet", color: "red" },
                    { name: "Yoshino", role: "Hermit", color: "cyan" },
                    { name: "Kurumi Tokisaki", role: "Nightmare", color: "rose" },
                    { name: "Kaguya Yamai", role: "Berserk", color: "orange" },
                    { name: "Yuzuru Yamai", role: "Berserk", color: "orange" },
                    { name: "Miku Izayoi", role: "Diva", color: "violet" },
                    { name: "Natsumi", role: "Witch", color: "emerald" },
                    { name: "Nia Honjo", role: "Sister", color: "gray" },
                    { name: "Mukuro Hoshimiya", role: "Zodiac", color: "yellow" },
                    { name: "Mana Takamiya", role: "Adeptus 2", color: "blue" },
                    { name: "Reine Murasame", role: "Phantom", color: "zinc" },
                    { name: "Isaac Westcott", role: "Villain", color: "slate" },
                    { name: "Ellen Mathers", role: "Adeptus 1", color: "purple" }
                ]
            }
        };

        // --- Router Logic ---
        function navigateTo(pageId, repoId = null) {
            const homeView = document.getElementById('view-home');
            const detailView = document.getElementById('view-detail');
            const navbar = document.getElementById('navbar');

            // Safe URL updating that catches sandbox security errors
            try {
                if (pageId === 'home') {
                    // Attempt to remove hash without page reload
                    if (window.history && window.history.pushState) {
                        window.history.pushState(null, '', window.location.pathname);
                    }
                } else if (pageId === 'detail' && repoId) {
                     if (window.history && window.history.pushState) {
                        window.history.pushState(null, '', `#project/${repoId}`);
                    }
                }
            } catch (e) {
                // In strictly sandboxed environments (like some blob/iframe previews),
                // modifying history or location might throw SecurityError.
                // We catch this so the UI transition still happens.
                console.warn("URL update suppressed due to sandbox restrictions.", e);
            }

            // View Switching
            if (pageId === 'home') {
                detailView.classList.remove('visible-page');
                detailView.classList.add('hidden-page');
                homeView.classList.remove('hidden-page');
                homeView.classList.add('visible-page');
                navbar.classList.remove('opacity-0');
                window.scrollTo(0, 0);
            } else if (pageId === 'detail' && repoId) {
                homeView.classList.remove('visible-page');
                homeView.classList.add('hidden-page');
                detailView.classList.remove('hidden-page');
                detailView.classList.add('visible-page');
                renderDetailPage(repoId);
                window.scrollTo(0, 0);
            }
        }

        function scrollToSection(id) {
            const el = document.getElementById(id);
            if (el) el.scrollIntoView({ behavior: 'smooth' });
        }

        window.addEventListener('popstate', () => {
            const hash = window.location.hash;
            if (hash.startsWith('#project/')) {
                const id = hash.replace('#project/', '');
                navigateTo('detail', id);
            } else {
                navigateTo('home');
            }
        });

        // --- Data Fetching & Rendering ---
        let GLOBAL_CACHE = {};

        async function fetchRepoData() {
            const extensionContainer = document.getElementById('extensions-grid');
            const lorebookContainer = document.getElementById('lorebooks-grid');
            const statsContainer = document.getElementById('global-stats');

            let totalStars = 0;
            let totalForks = 0;
            let htmlExtensions = '';
            let htmlLorebooks = '';

            for (const repo of REPOS) {
                let data;
                // Try fetching real GitHub data first
                try {
                    const response = await fetch(`https://api.github.com/repos/${repo.owner}/${repo.id}`);
                    if (!response.ok) throw new Error('API Error');
                    const apiData = await response.json();
                    
                    // Merge API data with our Enriched static data
                    data = { ...ENRICHED_DATA[repo.id], ...apiData }; 
                    // Always use local name override if available
                    data.name = ENRICHED_DATA[repo.id].name || apiData.name;
                    data.description = ENRICHED_DATA[repo.id].description;
                    data.imageUrl = ENRICHED_DATA[repo.id].imageUrl;

                } catch (error) {
                    data = ENRICHED_DATA[repo.id]; // Fallback completely
                }
                
                GLOBAL_CACHE[repo.id] = data; // Store for detail view
                GLOBAL_CACHE[repo.id].config = repo; // Store config

                totalStars += data.stargazers_count;
                totalForks += data.forks_count;

                const cardHtml = createCard(repo, data);
                if (repo.type === 'extension') {
                    htmlExtensions += cardHtml;
                } else {
                    htmlLorebooks += cardHtml;
                }
            }

            extensionContainer.innerHTML = htmlExtensions;
            lorebookContainer.innerHTML = htmlLorebooks;
            renderStats(totalStars, totalForks, REPOS.length);
            
            // Handle Direct Link on Load (wrapped in try catch for safety)
            try {
                const hash = window.location.hash;
                if (hash.startsWith('#project/')) {
                    const id = hash.replace('#project/', '');
                    if (GLOBAL_CACHE[id]) navigateTo('detail', id);
                }
            } catch (e) {
                // Ignore hash access errors
            }
        }

        function createCard(repoConfig, data) {
            const iconSvg = ICONS[repoConfig.icon];
            const updatedTime = timeAgo(data.pushed_at);
            const isLorebook = repoConfig.type === 'lorebook';
            const cardClass = isLorebook ? 'border-l-4 border-l-secondary' : 'border-t-4 border-t-primary';
            const btnClass = isLorebook ? 'hover:bg-secondary hover:border-secondary' : 'hover:bg-primary hover:border-primary';
            
            // Handle Background Image for cards (like lorebooks)
            const bgImageStyle = data.imageUrl 
                ? `background-image: url('${data.imageUrl}');` 
                : '';
            const bgOverlay = data.imageUrl 
                ? `<div class="absolute inset-0 bg-cover bg-center z-0 blur-[2px] opacity-40 hover:opacity-50 transition-opacity duration-500" style="${bgImageStyle}"></div>
                   <div class="absolute inset-0 bg-darker/80 z-0"></div>` 
                : '';

            // Only show upvotes if defined
            const upvoteHtml = data.upvotes ? `
                <span class="flex items-center gap-1 text-sm font-medium text-slate-300 bg-black/40 backdrop-blur-sm px-2 py-1 rounded-md">
                    ${ICONS.thumbsUp} ${data.upvotes}
                </span>
            ` : '';

            return `
                <div class="glass-card rounded-xl p-6 flex flex-col h-full ${cardClass} relative group overflow-hidden">
                    ${bgOverlay}
                    <div class="absolute top-0 right-0 w-32 h-32 bg-white/5 rounded-bl-full -mr-8 -mt-8 transition-transform group-hover:scale-150 z-0"></div>
                    
                    <div class="flex justify-between items-start mb-4 z-10 relative">
                        <div class="p-3 bg-slate-800/50 rounded-lg text-white backdrop-blur-sm">${iconSvg}</div>
                        <div class="flex items-center gap-2">
                             ${upvoteHtml}
                            <span class="flex items-center gap-1 text-sm font-medium text-slate-300 bg-black/40 backdrop-blur-sm px-2 py-1 rounded-md">
                                ${ICONS.star} ${data.stargazers_count}
                            </span>
                        </div>
                    </div>
                    
                    <h3 class="text-xl font-bold text-white mb-2 z-10 font-display relative">${data.name || repoConfig.id}</h3>
                    <p class="text-slate-300 text-sm mb-6 flex-grow z-10 leading-relaxed line-clamp-3 relative text-shadow-sm">
                        ${data.description}
                    </p>
                    
                    <div class="flex items-center justify-between mt-auto z-10 pt-4 border-t border-slate-700/50 relative">
                        <div class="flex flex-col">
                             <div class="flex items-center gap-1.5 text-xs text-slate-400 mb-1">
                                ${ICONS.update} ${updatedTime}
                            </div>
                        </div>
                        
                        <button onclick="navigateTo('detail', '${repoConfig.id}')" class="px-4 py-2 rounded-lg border border-slate-600 text-slate-200 text-sm font-medium transition-all ${btnClass} hover:text-white flex items-center gap-2 cursor-pointer bg-slate-900/50 backdrop-blur-sm">
                            View Details
                        </button>
                    </div>
                </div>
            `;
        }

        function renderDetailPage(repoId) {
            const data = GLOBAL_CACHE[repoId];
            if (!data) return;

            const container = document.getElementById('detail-content');
            const iconSvg = ICONS[data.config.icon];
            const isLorebook = data.config.type === 'lorebook';
            const accentColor = isLorebook ? 'text-secondary' : 'text-primary';
            const bgAccent = isLorebook ? 'bg-secondary' : 'bg-primary';
            
            // Header BG for detail view if image exists
            const headerBg = data.imageUrl 
                ? `style="background-image: linear-gradient(to right, rgba(15, 23, 42, 0.95), rgba(15, 23, 42, 0.8)), url('${data.imageUrl}'); background-size: cover; background-position: center;"`
                : 'class="glass"';

            const featuresHtml = data.features ? data.features.map(f => `
                <li class="flex items-start gap-3 mb-3 text-slate-300">
                    <div class="mt-1">${ICONS.check}</div>
                    <span>${f}</span>
                </li>
            `).join('') : '';

            // Models Section Generator
            let modelsHtml = '';
            if (data.models) {
                modelsHtml = `
                    <div class="mb-10">
                        <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                            <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"></path></svg>
                            Recommended Models
                        </h3>
                        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4">
                            ${data.models.map(model => `
                                <div class="glass p-4 rounded-xl border ${model.border} ${model.bg} flex flex-col items-center justify-center text-center transition-transform hover:scale-105">
                                    <div class="mb-2 ${model.color}">${ICONS[model.icon] || ICONS.cpu}</div>
                                    <div class="font-bold text-white text-sm">${model.name}</div>
                                    <div class="text-xs text-slate-400 mt-1">${model.provider}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }

            // Cast Carousel Generator
            let castHtml = '';
            if (data.cast) {
                 castHtml = `
                    <div class="mb-10">
                        <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                             <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
                             Spirit Registry
                        </h3>
                        <div class="carousel-container flex overflow-x-auto gap-4 pb-4 snap-x">
                             ${data.cast.map(char => `
                                <div class="flex-shrink-0 w-40 glass rounded-xl p-3 flex flex-col items-center snap-start border border-slate-700/50 hover:border-slate-500/50 transition-colors">
                                    <div class="w-24 h-24 rounded-full bg-slate-800 mb-3 overflow-hidden ring-2 ring-slate-700 ring-offset-2 ring-offset-slate-900">
                                        <img src="https://placehold.co/200x200/1e293b/white?text=${char.name.charAt(0)}" alt="${char.name}" class="w-full h-full object-cover opacity-80">
                                    </div>
                                    <div class="text-center">
                                        <div class="font-bold text-white text-sm truncate w-full">${char.name}</div>
                                        <div class="text-xs text-${char.color}-400 mt-1 font-medium uppercase tracking-wide">${char.role}</div>
                                    </div>
                                </div>
                             `).join('')}
                        </div>
                    </div>
                 `;
            }
            
            // Download Section Generator (DAL Specific)
            let downloadHtml = '';
            if (data.downloads) {
                downloadHtml = `
                    <div class="glass p-6 rounded-2xl mb-6 border-t-4 border-green-500">
                        <h3 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
                            ${ICONS.download} Download Lorebooks
                        </h3>
                        <div class="space-y-3">
                            ${data.downloads.map(dl => `
                                <a href="${dl.url}" target="_blank" class="flex items-center justify-between p-3 rounded-lg bg-slate-800/50 hover:bg-green-500/20 border border-white/5 hover:border-green-500/50 transition-all group">
                                    <span class="text-sm font-medium text-slate-300 group-hover:text-white">${dl.name}</span>
                                    <svg class="w-4 h-4 text-slate-500 group-hover:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                                </a>
                            `).join('')}
                        </div>
                    </div>
                `;
            }

            container.innerHTML = `
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Left Column: Content -->
                    <div class="lg:col-span-2 space-y-8">
                        <div ${headerBg} class="rounded-3xl p-8 border border-white/10 relative overflow-hidden">
                            <div class="relative z-10">
                                <div class="flex items-center gap-4 mb-6">
                                    <div class="p-4 bg-slate-800/50 backdrop-blur-md rounded-2xl ${accentColor} border border-white/10">
                                        ${iconSvg}
                                    </div>
                                    <div>
                                        <h1 class="text-4xl md:text-5xl font-display font-bold text-white mb-2 text-shadow">${data.name || repoId}</h1>
                                        <div class="flex items-center gap-4 text-sm text-slate-300">
                                            <span class="bg-slate-800/80 px-3 py-1 rounded-full text-white border border-white/5">${data.language}</span>
                                            <span>${timeAgo(data.pushed_at)}</span>
                                        </div>
                                    </div>
                                </div>
                                <p class="text-lg text-slate-200 leading-relaxed max-w-2xl">
                                    ${data.longDescription}
                                </p>
                            </div>
                        </div>
                        
                        <!-- Injected Models & Cast Section -->
                        ${modelsHtml}
                        ${castHtml}
                        
                        <div class="glass p-8 rounded-2xl">
                            <h3 class="text-xl font-bold text-white mb-6">Key Features</h3>
                            <ul class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                ${featuresHtml}
                            </ul>
                        </div>
                    </div>

                    <!-- Right Column: Sidebar -->
                    <div class="space-y-6">
                        <!-- Actions -->
                        <div class="glass p-6 rounded-2xl border-t-4 ${isLorebook ? 'border-secondary' : 'border-primary'}">
                            <div class="flex justify-between items-center mb-6">
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-white">${data.stargazers_count}</div>
                                    <div class="text-xs text-slate-500 uppercase tracking-wider">Stars</div>
                                </div>
                                
                                ${data.upvotes ? `
                                <div class="w-px h-10 bg-slate-700"></div>
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-white">${data.upvotes}</div>
                                    <div class="text-xs text-slate-500 uppercase tracking-wider">Upvotes</div>
                                </div>
                                ` : ''}

                                <div class="w-px h-10 bg-slate-700"></div>
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-white">${data.forks_count}</div>
                                    <div class="text-xs text-slate-500 uppercase tracking-wider">Forks</div>
                                </div>
                            </div>
                            
                            <a href="https://github.com/${data.config.owner}/${data.config.id}" target="_blank" class="block w-full py-3 mb-3 rounded-lg ${bgAccent} hover:brightness-110 text-white font-bold text-center transition-all">
                                View on GitHub
                            </a>
                            
                            ${!isLorebook ? `
                            <div class="relative">
                                <div class="text-xs text-slate-500 mb-2 uppercase font-bold tracking-wider">Install Link</div>
                                <div class="bg-black/40 rounded-lg p-3 text-xs font-mono text-slate-300 break-all border border-white/5 cursor-pointer hover:border-white/20 transition-colors" onclick="copyToClipboard('${data.installCommand}')">
                                    $ ${data.installCommand}
                                </div>
                            </div>
                            ` : ''}
                        </div>
                        
                        <!-- Injected Downloads (DAL) -->
                        ${downloadHtml}

                         <!-- Creator Info -->
                        <div class="glass p-6 rounded-2xl">
                             <div class="flex items-center gap-3 mb-4">
                                <!-- Updated PFP in Creator Card -->
                                <img src="https://github.com/user-attachments/assets/0c368a6d-2aea-41ec-a6fd-823168b3fd29" alt="Archkr" class="w-10 h-10 rounded-full object-cover bg-slate-700">
                                <div>
                                    <div class="text-white font-bold">Archkr</div>
                                    <div class="text-xs text-slate-500">Maintainer</div>
                                </div>
                            </div>
                            <p class="text-sm text-slate-400 italic">
                                "I got bored."
                            </p>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderStats(stars, forks, repos) {
             const container = document.getElementById('global-stats');
             container.innerHTML = `
                <div class="glass p-6 rounded-2xl flex items-center gap-4">
                    <div class="p-3 bg-yellow-500/10 rounded-lg text-yellow-500">
                        <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"></path></svg>
                    </div>
                    <div>
                        <div class="text-3xl font-display font-bold text-white">${stars}</div>
                        <div class="text-slate-400 text-sm">Total Stars</div>
                    </div>
                </div>
                <div class="glass p-6 rounded-2xl flex items-center gap-4">
                    <div class="p-3 bg-blue-500/10 rounded-lg text-blue-500">
                        <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"></path></svg>
                    </div>
                    <div>
                        <div class="text-3xl font-display font-bold text-white">${forks}</div>
                        <div class="text-slate-400 text-sm">Community Forks</div>
                    </div>
                </div>
                <div class="glass p-6 rounded-2xl flex items-center gap-4">
                    <div class="p-3 bg-purple-500/10 rounded-lg text-purple-500">
                        <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path></svg>
                    </div>
                    <div>
                        <div class="text-3xl font-display font-bold text-white">${repos}</div>
                        <div class="text-slate-400 text-sm">Active Projects</div>
                    </div>
                </div>
             `;
        }

        // Utils
        function timeAgo(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const seconds = Math.floor((now - date) / 1000);
            if (seconds < 60) return 'Updated just now';
            const minutes = Math.floor(seconds / 60);
            if (minutes < 60) return `Updated ${minutes}m ago`;
            const hours = Math.floor(minutes / 60);
            if (hours < 24) return `Updated ${hours}h ago`;
            const days = Math.floor(hours / 24);
            return `Updated ${days}d ago`;
        }
        
        function copyToClipboard(text) {
            const el = document.createElement('textarea');
            el.value = text;
            document.body.appendChild(el);
            el.select();
            document.execCommand('copy');
            document.body.removeChild(el);
             
            // Custom Toast
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = 'toast animate-toast-in';
            toast.innerHTML = `
                <svg class="w-6 h-6 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                <div class="flex flex-col">
                    <span class="font-bold text-sm">Copied!</span>
                    <span class="text-xs text-slate-400">Command copied to clipboard.</span>
                </div>
            `;
            
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.classList.remove('animate-toast-in');
                toast.classList.add('animate-toast-out');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        function copyCoT() {
            const content = document.getElementById('cot-content').innerText;
            copyToClipboard(content);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', fetchRepoData);
        // Navbar Scroll Effect
        window.addEventListener('scroll', () => {
            const nav = document.getElementById('navbar');
            if (window.scrollY > 20) {
                nav.classList.add('bg-darker/80', 'backdrop-blur-md', 'shadow-lg');
            } else {
                nav.classList.remove('bg-darker/80', 'backdrop-blur-md', 'shadow-lg');
            }
        });

    </script>
</body>
</html>
